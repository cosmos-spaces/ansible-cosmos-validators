# - name: Write new entry to prom-cosmos.yml
#   blockinfile:
#     path: "/etc/prometheus/{{ cosmos_prom_file }}.yml"
#     backup: true
#     block: |
#       - targets: ['{{ hostvars[item].ansible_host }}:{{ custom_port_prefix }}61']
#         labels:
#           instance: {{ hostvars[item].server_hostname }}
#           chain_id: {{ chain_id }}
#           network: {{ target }}
#           type: {{ hostvars[item].type }}
#   loop: "{{ groups[target] }}"
#   when: groups[target] is defined

# # - name: Restart the Prometheus Server to pick up new configuration
# #   shell: |
# #     PROM_PID=$(top -b -n 1 | grep "prometheus" | awk '{print $1}')
# #     if [ -n "$PROM_PID" ]; then
# #       kill -1 $PROM_PID
# #     else
# #       echo "Prometheus process not found."
# #     fi

# - name: Check if Prometheus up and running with no errors
#   systemd_service:
#     name: prometheus.service
#     state: started
#   register: prometheusd_status

# - name: Check if Prometheus is responding via cURL
#   shell: |
#     curl -s -w "\nHTTP Status Code: %{http_code}\n" localhost:9090/-/healthy
#     curl -s -w "\nHTTP Status Code: %{http_code}\n" localhost:9090/-/ready
#   register: prometheus_curl_status

# - name: Results after restarting for new configuration
#   debug:
#     msg:
#       systemd_status: "{{ prometheusd_status }}"
#       curl_status: "{{ prometheus_curl_status }}"

- name: Results after restarting for new configuration
  debug:
    msg:
      msg: "{{ groups[target] }}"
